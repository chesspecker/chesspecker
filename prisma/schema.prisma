generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sets PuzzleSet[]

  totalPuzzleSolved Int @default(0)
  totalSetCompleted Int @default(0)
  totalTimePlayed   Int @default(0)
}

model PuzzleSet {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id])
  userId String

  puzzleSetItems PuzzleSetItem[]

  title         String
  currentCycle  Int    @default(0)
  currentTime   Int    @default(0)
  currentPuzzle Int    @default(0)
}

model Puzzle {
  id        String   @id
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  puzzleSetItems PuzzleSetItem[]

  fen             String
  moves           String[]
  rating          Int
  ratingDeviation Int
  popularity      Int
  nbPlays         Int
  gameUrl         String
  openingTags     String[]
}

model PuzzleSetItem {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  puzzleSet   PuzzleSet @relation(fields: [puzzleSetId], references: [id])
  puzzleSetId String

  puzzle   Puzzle @relation(fields: [puzzleId], references: [id])
  puzzleId String

  order     Int
  mistakes  Int[]
  timeTaken Float[]
  grades    Int[]
}
